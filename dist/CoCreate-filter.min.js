/* CoCreateJS */
function CoCreateFilter(){this.items=[]}CoCreateFilter.prototype={constructor:CoCreateFilter,setFilter:function(t,e,r){if(!e)return;let i=t.getAttribute(e);if(!i)return;let a=t.getAttribute("data-fetch_collection")?t.getAttribute("data-fetch_collection"):"module_activity",l=t.getAttribute("data-fetch_name"),n=t.getAttribute("data-fetch_value"),o=t.getAttribute("data-search_type"),c="true"==t.getAttribute("data-fetch_collection_list"),u=t.getAttribute("data-order_by"),s=t.getAttribute("data-order_type")||"asc",f=parseInt(t.getAttribute("data-fetch_count")),d={el:t,id:i,eId:i,type:r,attrName:e,collection:a,startIndex:0,options:{},fetch:{},is_collection:c,search:{type:"or",value:[]},orders:[],filters:[]};return!isNaN(f)&&f>0&&(d.count=f),o&&(d.search.type=o),u&&d.orders.push({name:u,type:"asc"==s?1:-1}),l&&n&&(d.fetch={name:l,value:n}),this._initFilter(d,i,e),this.items.push(d),this._initInputForm(d,e),d},_initFilter:function(t,e,r){let i=t.el.getRootNode().querySelectorAll("["+r+'="'+e+'"]');for(var a=0;a<i.length;a++){let l=i[a],n=l.getAttribute("data-filter_name"),o=l.getAttribute("data-filter_operator")?l.getAttribute("data-filter_operator"):"contain",c=l.getAttribute("data-value_type")?l.getAttribute("data-value_type"):"string",u=l.getAttribute("data-filter_value");if(u&&""!=u)if(u=u.replace(/\s/g,"").split(","),n){let e=this.getFilterByName(t,n,o);if("string"!=c)for(let t=0;t<u.length;t++)u[t]=Number(u[t]);this.insertArrayObject(t.filters,e,{name:n,value:u,operator:o})}else t.search.value=this._makeSearchOption(e,r)}},changeCollection:function(t){let e=t.el.getAttribute("data-fetch_collection")?t.el.getAttribute("data-fetch_collection"):"module_activity";t.collection=e,t.startIndex=0},_makeSearchOption:function(t,e){let r=document.querySelectorAll("form["+e+"="+t+"]"),i="["+e+"="+t+"]",a=document.querySelectorAll("input"+i+",textarea"+i+", select"+i),l=[];for(let t=0;t<r.length;t++){let e=r[t].querySelectorAll("input, textarea, select");e=Array.prototype.slice.call(e),l=l.concat(e)}a=Array.prototype.slice.call(a),l=l.concat(a);let n=[];for(var o=0;o<l.length;o++){let t=l[o].getAttribute("data-filter_name"),e=l[o].getAttribute("data-order_by"),r=l[o],i=r.getAttribute("data-value_type")?r.getAttribute("data-value_type"):"string",a=null;t||e||("checkbox"!=r.type||r.checked?(a=r.value,"string"!=i&&(a=Number(a)),a&&!n.includes(a)&&n.push(a)):a=null)}return n},_initInputForm:function(t,e){if(!t)return;let r="["+e+'="'+t.id+'"]',i=t.el.getRootNode().querySelectorAll("form"+r+" input, form"+r+" textarea, form"+r+" select"),a=t.el.getRootNode().querySelectorAll("input"+r+",textarea"+r+", select"+r);this.setCheckboxName(t.id,e),i=Array.prototype.slice.call(i),a=Array.prototype.slice.call(a),i=i.concat(a),console.log("input form",r);for(let e=0;e<i.length;e++){let r=i[e];r.getAttribute("data-order_by")?this._initOrderInput(t,r):this._initFilterInput(t,r,t.id)}},_initOrderInput:function(t,e){var r=this;e.addEventListener("change",function(e){e.preventDefault();let i=this.getAttribute("data-order_by"),a=0,l=r.getOrderByName(t,i);a="asc"==this.value?1:"desc"==this.value?-1:[],r.insertArrayObject(t.orders,l,{name:i,type:a},a),t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"order"}}))})},_initFilterInput:function(t,e,r){var i,a=this;e.addEventListener("input",function(l){l.preventDefault();let n=this.getAttribute("data-filter_name"),o=this.getAttribute("data-filter_operator")||"contain",c=this.getAttribute("data-value_type")||"string";clearTimeout(i),i=setTimeout(function(){if(n){let r=a.getFilterByName(t,n,o),s=e.type,f=[];if("checkbox"==s){e.value;for(var i=document.querySelectorAll("input[name="+e.name+"]:checked"),l=0;l<i.length;l++)f.push(i[l].value)}else if("raido"==s);else if("range"==s)f=[Number(e.min),Number(e.value)];else{var u=e.value;"string"!=c&&(u=Number(u)),"none"!=u&&(f=[u])}a.insertArrayObject(t.filters,r,{name:n,value:f,operator:o})}else t.search.value=a._makeSearchOption(r,t.attrName);t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"filter"}}))},500)})},setCheckboxName:function(t,e){for(var r=document.querySelectorAll("form["+e+'="'+t+'"]'),i=0;i<r.length;i++)for(var a=r[i].querySelectorAll("input[type=checkbox], form input[type=radio]"),l=0;l<a.length;l++){var n=a[l].getAttribute("name"),o=a[l].getAttribute("data-filter_name");!n&&o&&a[l].setAttribute("name","_"+t+"-"+o+"_"+i)}},getFilterByName:function(t,e,r){for(var i=0;i<t.filters.length;i++){var a=t.filters[i];if(a.name==e&&a.operator==r)return i}return-1},insertArrayObject:function(t,e,r,i){return i||(i=r.value),"object"==typeof i&&0==i.length?-1!=e&&t.splice(e,1):-1!=e?t[e]=r:t.push(r),t},getOrderByName:function(t,e){for(var r=0;r<t.orders.length;r++)if(t.orders[r].name==e)return r;return-1},defineEvent:function(t){t.el.addEventListener("fetchFilterData",function(t){console.log(t)})},fetchData:function(t){let e=this.makeFetchOptions(t);CoCreate.readDocumentList(e)},getObjectByFilterId:function(t,e){for(var r=0;r<t.length;r++){let i=t[r].filter;if(i&&i.id==e)return t[r]}},getObjectByElement:function(t,e){for(var r=0;r<t.length;r++){let i=t[r].filter;if(i&&i.el.isSameNode(e))return t[r]}},makeFetchOptions:function(t){let e={collection:t.collection,element:t.eId,metadata:"",operator:{fetch:t.fetch,filters:t.filters,orders:t.orders,search:t.search,startIndex:t.startIndex},is_collection:t.is_collection};return t.count&&(e.operator.count=t.count),e}};var g_cocreateFilter=new CoCreateFilter;console.log(g_cocreateFilter);